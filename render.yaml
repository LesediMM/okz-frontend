# Render Blueprint for OKZ Sports Application
services:
  # Frontend Static Site
  - type: web
    name: okz-frontend
    env: static
    buildCommand: npm install && npm run build
    staticPublishPath: ./dist
    routes:
      - type: rewrite
        source: /api/*
        destination: https://okz-backend.onrender.com/api/$1
    headers:
      - path: /*
        name: Content-Security-Policy
        value: "default-src 'self'; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://fonts.googleapis.com; font-src 'self' https://cdnjs.cloudflare.com https://fonts.gstatic.com; img-src 'self' data: https:; connect-src 'self' https://okz-backend.onrender.com;"
      - path: /*
        name: X-Frame-Options
        value: DENY
      - path: /*
        name: X-Content-Type-Options
        value: nosniff
      - path: /*
        name: Referrer-Policy
        value: strict-origin-when-cross-origin
      - path: /*
        name: Permissions-Policy
        value: "camera=(), microphone=(), geolocation=()"
    envVars:
      - key: VITE_API_URL
        value: https://okz-backend.onrender.com/api/v1

  # Backend API Service
  - type: web
    name: okz-backend
    env: python
    buildCommand: pip install -r requirements.txt
    startCommand: python server.py
    envVars:
      - key: MONGO_URI
        sync: false
      - key: JWT_SECRET
        generateValue: true
      - key: NODE_ENV
        value: production
      - key: FRONTEND_URL
        value: https://okz-frontend.onrender.com
      - key: ADMIN_USERNAME
        sync: false
      - key: ADMIN_PASSWORD
        sync: false
    autoDeploy: true
    healthCheckPath: /health

# Database (MongoDB Atlas - External)
# Note: You need to create a MongoDB Atlas cluster separately
# and add the connection string as an environment variable

# Environment Variables Group
envVarGroups:
  - name: okz-production
    envVars:
      - key: NODE_ENV
        value: production
      - key: APP_NAME
        value: OKZ Sports
      - key: APP_VERSION
        value: 1.0.0

# CORS Configuration
cors:
  allowOrigins:
    - https://okz-frontend.onrender.com
    - http://localhost:3000
  allowMethods:
    - GET
    - POST
    - PUT
    - DELETE
    - OPTIONS
  allowHeaders:
    - Content-Type
    - Authorization
    - X-Requested-With
  allowCredentials: true
  maxAge: 86400

# Build and Deploy Settings
buildFilters:
  - paths:
      - "src/**"
      - "public/**"
      - "*.js"
      - "*.json"
      - "*.html"
      - "*.css"

# Deployment Settings
deployHooks:
  - name: Build Successful
    type: webhook
    url: https://api.render.com/deploy/succeeded

# Resource Scaling (if needed)
# scaling:
#   minInstances: 1
#   maxInstances: 3
#   targetMemoryPercent: 70
#   targetCPUPercent: 70

# Disk (for persistent storage if needed)
# disk:
#   name: data
#   mountPath: /data
#   sizeGB: 1

# Service Discovery (for microservices architecture)
# serviceDiscovery:
#   - name: okz-backend
#     dnsName: okz-backend.internal

# Scheduled Jobs (if needed for cleanup, reports, etc.)
# scheduledJobs:
#   - name: daily-cleanup
#     schedule: "0 2 * * *"  # Run at 2 AM daily
#     command: python cleanup.py